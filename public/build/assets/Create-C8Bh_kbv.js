import{j as e,r,u as ne,H as Ne,a as Se}from"./app-Cm4b0MRZ.js";import{X as Ce,G as ke,A as Pe,B as _e}from"./app-layout-CKTzcKJV.js";import{c as te,a as X,u as ce}from"./createLucideIcon-CDzehuva.js";import{C as De,T as Ie,a as qe}from"./custom-icon-button-Hy4gbVgR.js";import{C as q}from"./custom-input-C8zmYmQE.js";import{C as Q}from"./custom-selection-GEqW07Tw.js";import{C as Te}from"./custom-submit-button-C9KFqMKP.js";import{L as Re,I as Fe}from"./label-CX7AZ_dB.js";import{b as Me,c as Be,a as Ee,d as $e}from"./index-BzTAvke0.js";import{u as Ae}from"./index-9i02cyU4.js";import{P as de}from"./index-0pHPRr8x.js";import{C as ie}from"./custom-text-area-DMdpB5BL.js";import{C as Le}from"./custom-toaster-Ct6F5So0.js";import{s as ee,a as E}from"./numberSanitizer-Dj-CgJwP.js";import{s as He}from"./index-vmwrf4-U.js";import{P as Oe}from"./plus-BiNzPZGp.js";import"./app-BUjcEukZ.js";import"./loader-CORz_YrV.js";import"./input-4zn4-9bI.js";import"./search-Czf_K0T6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],Ke=te("Car",ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Qe=te("CirclePlus",Ue);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]],Ge=te("Tags",Xe);function oe({className:c,...d}){return e.jsx("div",{"data-slot":"skeleton",className:X("bg-primary/10 animate-pulse rounded-md",c),...d})}const Ve=({productCount:c,total:d,fee:n=0})=>{const[u,l]=r.useState(!0);return e.jsxs(e.Fragment,{children:[u&&e.jsxs("div",{className:"fixed top-15 right-2 z-50 grid items-center gap-2 rounded-2xl border bg-white px-2 py-2 shadow-lg transition-all duration-600",children:[e.jsxs("div",{className:"flex gap-4 justify-around",children:[e.jsx("button",{onClick:()=>l(!1),className:"absolute -top-2 -right-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white shadow hover:bg-red-300",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-green-500 text-xs font-bold text-white",children:c}),e.jsxs("span",{className:"text-sm font-semibold text-red-700",children:[Math.round(d)," Ksh"]})]}),n>0&&e.jsxs("div",{className:"flex gap-2 justify-around items-center",children:[e.jsxs("span",{className:"rounded-full  p-0.5 text-center text-xs text-black",children:[" ",e.jsx(Ke,{})," "]}),e.jsxs("span",{className:"text-red-700 text-xs font-bolder",children:[n," Ksh"]})]})]}),!u&&e.jsx("button",{onClick:()=>l(!0),className:"fixed right-1 bottom-6 z-50 flex items-center gap-1 rounded bg-green-500/70 py-2 text-white shadow-lg transition hover:bg-green-300",children:e.jsx(De,{className:"font-bolder h-6 w-4"})})]})};var G="Switch",[We,wt]=Be(G),[Je,Ye]=We(G),ue=r.forwardRef((c,d)=>{const{__scopeSwitch:n,name:u,checked:l,defaultChecked:S,required:C,disabled:j,value:v="on",onCheckedChange:T,form:y,...k}=c,[x,P]=r.useState(null),o=ce(d,h=>P(h)),f=r.useRef(!1),A=x?y||!!x.closest("form"):!0,[R,_]=Me({prop:l,defaultProp:S??!1,onChange:T,caller:G});return e.jsxs(Je,{scope:n,checked:R,disabled:j,children:[e.jsx(de.button,{type:"button",role:"switch","aria-checked":R,"aria-required":C,"data-state":he(R),"data-disabled":j?"":void 0,disabled:j,value:v,...k,ref:o,onClick:Ee(c.onClick,h=>{_(g=>!g),A&&(f.current=h.isPropagationStopped(),f.current||h.stopPropagation())})}),A&&e.jsx(xe,{control:x,bubbles:!f.current,name:u,value:v,checked:R,required:C,disabled:j,form:y,style:{transform:"translateX(-100%)"}})]})});ue.displayName=G;var me="SwitchThumb",pe=r.forwardRef((c,d)=>{const{__scopeSwitch:n,...u}=c,l=Ye(me,n);return e.jsx(de.span,{"data-state":he(l.checked),"data-disabled":l.disabled?"":void 0,...u,ref:d})});pe.displayName=me;var Ze="SwitchBubbleInput",xe=r.forwardRef(({__scopeSwitch:c,control:d,checked:n,bubbles:u=!0,...l},S)=>{const C=r.useRef(null),j=ce(C,S),v=Ae(n),T=$e(d);return r.useEffect(()=>{const y=C.current;if(!y)return;const k=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(k,"checked").set;if(v!==n&&P){const o=new Event("click",{bubbles:u});P.call(y,n),y.dispatchEvent(o)}},[v,n,u]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...l,tabIndex:-1,ref:j,style:{...l.style,...T,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});xe.displayName=Ze;function he(c){return c?"checked":"unchecked"}var fe=ue,et=pe;const be=r.forwardRef(({className:c,...d},n)=>e.jsx(fe,{className:X("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",c),...d,ref:n,children:e.jsx(et,{className:X("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));be.displayName=fe.displayName;const tt=({checked:c,onChange:d,label:n,hideLabel:u=!1,className:l,error:S})=>e.jsxs("div",{className:X("grid gap-2",l),children:[e.jsxs(Re,{className:"grid cursor-pointer gap-2",children:[!u&&e.jsx("span",{className:"",children:n}),e.jsx(be,{checked:c,onCheckedChange:d})]}),e.jsx(Fe,{message:S,className:"mt-2"})]}),$=c=>({index:c,id:null,price:0,subTotal:0,batchNumber:"",name:"",quantity:"",display_name:"",unit:""});function Nt({customers:c,products:d,deliveries:n,riders:u}){const{errors:l}=ne().props,{flash:S}=ne().props,[C,j]=r.useState(!0),[v,T]=r.useState(null),[y,k]=r.useState(1),[x,P]=r.useState(!1),[o,f]=r.useState([$(0)]),[A,R]=r.useState(0),_={rider_id:null,delivery_id:null,description:"",status:"pending"},[h,g]=r.useState(_),[ve,se]=r.useState(!1);r.useEffect(()=>{const t=o.filter(i=>i.id!=null&&Number(i.quantity)>0);R(t.length);const s=o[o.length-1],a=s.id!=null&&Number(s.quantity)>0;j(!a)},[o]);const ye=(t,s)=>{const a=d.find(p=>p.id===t?.value),i=[...o],m=i[s];if(!a)i[s]=$(m.index),i[s].quantity=m.quantity,i[s].quantityRaw=m.quantityRaw;else{const p=Number(m.quantity)||0;i[s]={...m,id:a.id,name:a.name,price:a.price,display_name:a.display_name,unit:a.unit,subTotal:Number((p*a.price).toFixed(2))||0}}f(i)},ae=t=>{const s=o.filter((a,i)=>i!==t);s.length===0&&(s.push($(y)),k(a=>a+1)),f(s)},ge=()=>{const t=o[o.length-1];t.id==null||Number(t.quantity)===0||t.quantity===""||(f(s=>[...s,$(y)]),k(s=>s+1))},w=o.reduce((t,s)=>t+s.subTotal,0).toFixed(0),[N,V]=r.useState(0),[F,W]=r.useState(0),[M,re]=r.useState(0),[J,Y]=r.useState(w),[L,H]=r.useState(null),[Z,O]=r.useState(null),[z,K]=r.useState(null),je=n&&n.length>0,[b,D]=r.useState({raw:"",numeric:0}),I=r.useMemo(()=>Number(w)+Number(b?.numeric??0),[w,b.numeric]),U=(t,s)=>{let a=F,i=N;t==="mpesa"?(a=s,W(s)):(i=s,V(s)),a+i>I&&(t==="mpesa"?(a=I-i,W(Math.max(0,a))):(i=I-a,V(Math.max(0,i))));const m=a+i;re(m),Y((I-m).toFixed(0))};r.useEffect(()=>{const t=I-M;Y(t.toFixed(0))},[I,M]),r.useEffect(()=>{U("cash",N)},[I,U,N]);const le=r.useMemo(()=>({customer:v,total:parseInt(w).toString(),products:o.filter(t=>t.id!=null&&Number(t.quantity)>0),cash:N,mpesa:F,balance:J,totalPaid:M,isDelivery:x,deliveryData:x?h:null,deliveryFee:x?b:null}),[v,w,o,N,F,J,M,x,h,b]),we=()=>{se(!0),Se.post(He("sales.store",le),{},{onSuccess:()=>{T(null),f([$(0)]),k(1),V(0),W(0),re(0),Y(w),P(!1),g(_),O(null),K(null),D({raw:"",numeric:0}),H(null)},onFinish:()=>{se(!1)}})},B=ke();return e.jsxs(Pe,{children:[e.jsx(Ne,{title:"Sales"}),e.jsx(Le,{flash:S}),e.jsxs("div",{className:"flex w-full flex-col justify-center",children:[e.jsxs("div",{className:"flex w-full items-center justify-between px-4",children:[e.jsx("h1",{className:"text-2xl font-medium",children:"Sales"}),e.jsx(Ve,{fee:Number(le.deliveryFee?.numeric),productCount:A,total:isNaN(Number(w))?0:Number(w)})]}),e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsxs("div",{className:"m-2 flex w-11/12 flex-col justify-center gap-4 rounded border-2 border-black p-4 md:w-10/12",children:[e.jsx("div",{className:"font-bold uppercase",children:"Customer & Delivery"}),e.jsxs("div",{className:"flex w-full justify-between gap-4",children:[e.jsx(Q,{align:"start",data:c.map(t=>({id:t.id,name:t.user.name})),onSelect:t=>T(t),selectedOption:v,label:"Select Customer",className:"w-full",error:l.customer}),e.jsx(tt,{checked:x,onChange:()=>{P(!x),H(null),g(_),O(null),K(null),D({raw:"",numeric:0})},label:"Set as Delivery?",className:"text-xs md:text-base",error:l.isDelivery||l.deliveryData})]}),x&&e.jsxs("div",{className:"flex items-center justify-center gap-4 border-0 pt-2 md:justify-around",children:[L==null?e.jsxs(oe,{onClick:()=>{H(!0),O(null),K(null),g(_),D({raw:"",numeric:0})},className:"flex flex-col h-[100px] w-1/2 cursor-pointer items-center text-center text-xs md:text-base justify-center gap-2 overflow-hidden p-2 hover:border-2 hover:bg-primary/70 hover:shadow-2xs md:w-1/4",children:[e.jsx(Qe,{})," Create new delivery"]}):L===!0?e.jsxs("div",{className:"flex w-full flex-col gap-6 md:items-center",children:[e.jsx(Q,{data:u.map(t=>({id:t.id,name:t.user.name})),onSelect:t=>{O(t.value),g({rider_id:t.value,status:"pending",delivery_id:null,description:""})},selectedOption:Z?{value:Z,label:u.find(t=>t.id===Z)?.user.name||""}:null,align:"start",label:"Select Rider",placeholder:"Select a rider to create delivery",error:l.rider_id}),e.jsx(q,{id:"delivery_fee",name:"deliver_fee",label:"Delivery Fee (KSH)",placeholder:"Enter amount to charge for delivery",type:"text",value:b.raw??(isNaN(Number(b.raw))?"":String(b.numeric)),onChange:t=>{const{raw:s,numeric:a}=E(t.target.value);D({raw:s,numeric:a})},onBlur:t=>{const{raw:s,numeric:a}=ee(t.target.value);D({raw:s,numeric:a})},error:l.deliveryFee}),e.jsx(ie,{id:"description",label:"Delivery description",value:h.description||"",onChange:t=>{g({...h,description:t.target.value||""})}})]}):e.jsx(e.Fragment,{}),L==null?je&&e.jsxs(oe,{onClick:()=>H(!1),className:"flex flex-col h-[100px] w-1/2 cursor-pointer items-center text-center text-xs md:text-base justify-center gap-2 overflow-hidden px-2 hover:border-2 hover:bg-primary/70 hover:shadow-2xs md:w-1/4",children:[e.jsx(Ge,{})," Attach to a delivery"]}):L===!1?e.jsxs("div",{className:"flex w-full flex-col gap-6 md:items-center",children:[e.jsx(Q,{data:n?.map(t=>({id:t.id,name:`Delivery #${t.id} - ${t.rider.user.name} (${t.status})`}))||[],label:"Select Delivery",placeholder:"Select Delivery to attach sale to",onSelect:t=>{const s=n?.find(a=>a.id===t.value)||{};K(t.value),g({..._,delivery_id:s.id,description:s.description||""})},selectedOption:z?{value:z,label:`Delivery #${z} - ${n?.find(t=>t.id===z)?.rider.user.name} `}:null,align:"start",error:l.delivery_id}),e.jsx(ie,{id:"description",label:"Delivery description",value:h.description||"",onChange:t=>{g({...h,description:t.target.value||""})}}),e.jsx(q,{id:"delivery_fee",name:"deliver_fee",label:"Delivery Fee (KSH)",placeholder:"Enter amount to charge for delivery",type:"text",value:b.raw??(isNaN(Number(b.raw))?"":String(b.numeric)),onChange:t=>{const{raw:s,numeric:a}=E(t.target.value);D({raw:s,numeric:a})},onBlur:t=>{const{raw:s,numeric:a}=ee(t.target.value);D({raw:s,numeric:a})},error:l.deliveryFee})]}):e.jsx(e.Fragment,{})]})]}),e.jsxs("div",{className:"m-2 flex w-11/12 flex-col justify-center gap-4 rounded border-2 border-black p-4 md:w-10/12",children:[e.jsx("div",{className:"font-bold uppercase",children:"Sales Products"}),o.map((t,s)=>e.jsx("div",{className:"flex w-full flex-col items-center justify-between",children:e.jsxs("div",{className:"md grid w-full items-center gap-6 rounded-2xl border md:flex md:justify-around",children:[B?e.jsxs("div",{className:"ms-4 mt-4 font-bold",children:["Product No: ",s+1]}):e.jsxs(_e,{className:"ms-4 mt-3 h-6 w-6",children:[" ",s+1]}),e.jsx(Q,{data:d,label:"select",placeholder:"Select Product",onSelect:a=>{ye(a,s)},selectedOption:o[s].id?{value:o[s].id,label:o[s].display_name}:null,className:"mx-4",error:l[`products.${s}.id`]||l.products}),e.jsx(q,{className:"flex-1 px-4",id:`quantity-${s}`,name:"quantity",label:"Quantity",type:"text",step:.1,value:t.quantityRaw??(t.quantity===""?"":String(t.quantity)),disabled:t.id==null,onChange:a=>{const{raw:i,numeric:m}=E(a.target.value),p=[...o];p[s]={...p[s],quantityRaw:i,quantity:m,subTotal:m*(p[s].price??0)},f(p)},onBlur:a=>{const{raw:i,numeric:m}=ee(a.target.value),p=[...o];p[s]={...p[s],quantityRaw:i,quantity:m,subTotal:m*(p[s].price??0)},f(p)},error:l[`products.${s}.quantity`]}),B&&e.jsxs("div",{className:"mx-4 flex items-center justify-between",children:[t.price!=0?e.jsx("div",{className:"text-xs",children:`@ ${t.price} / ${t.unit}`}):e.jsx("div",{}),e.jsx("div",{className:"text-xs font-bold text-green-400 md:mt-5 md:border-b-2",children:e.jsx("span",{children:`Cost ${t.subTotal.toFixed(0)} Ksh`})})]}),!B&&t.price!=0?e.jsx("div",{className:"mt-4 flex items-center justify-center gap-3 font-bold",children:`@ ${t.price}/ ${t.unit}`}):e.jsx("div",{}),!B&&e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-2 p-2 px-6 text-green-400 md:border-b-2 md:font-bold",children:[e.jsxs("span",{children:["Cost: ",t.subTotal.toFixed(0)]})," ",e.jsx("span",{children:"ksh"})]}),B?e.jsx("div",{onClick:()=>ae(s),className:"rounded-0 w-full rounded-b-2xl bg-red-900 p-2 text-center font-bold text-red-100 active:bg-red-700",children:"Remove"}):e.jsx("div",{onClick:()=>ae(s),className:"rounded-s-0 flex h-22 w-8 items-center justify-center rounded-e-2xl bg-red-900 hover:cursor-pointer hover:bg-red-700",children:e.jsx(Ie,{className:"h-6 w-5"})})]})},t.index)),e.jsx("div",{className:"flex justify-end px-4",children:e.jsx(qe,{icon:Oe,label:"Add Product",showLabel:!0,onClick:ge,disabled:C,className:"w-[150px] bg-primary/90 p-2 hover:bg-primary/30"})})]}),e.jsxs("div",{className:"m-2 mx-5 flex w-11/12 flex-col justify-center gap-4 rounded border-2 border-black p-4 md:w-10/12",children:[e.jsx("div",{className:"font-bold uppercase",children:"Payment Details"}),e.jsxs("div",{className:"grid grid-cols-2 items-center justify-center gap-4 md:flex",children:[e.jsx(q,{id:"mpesa",name:"mpesa",label:"Mpesa Amount",type:"text",placeholder:"0 ksh ",value:!isNaN(F)&&F!==0?F:"",onChange:t=>{const{numeric:s}=E(t.target.value);U("mpesa",s)}}),e.jsx(q,{id:"cash",name:"cash",label:"Cash Amount",type:"text",placeholder:"0 ksh ",value:!isNaN(N)&&N!==0?N:"",onChange:t=>{const{numeric:s}=E(t.target.value);U("cash",s)}}),e.jsx(q,{id:"total",name:"total",readOnly:!0,label:"Total Paid",inputClassName:"bg-green-100",className:"text-start font-bold text-green-800 md:w-1/2",value:`${M} ksh`,error:l.totalPaid}),e.jsx(q,{id:"balance",name:"balance",label:"Balance",readOnly:!0,inputClassName:"text-end bg-red-100",className:"text-end font-bold text-red-800 md:w-1/2",value:`${J} ksh`})]})]}),e.jsx("div",{className:"full m-2 flex w-full flex-col justify-center gap-4 rounded border-0 px-2",children:e.jsx(Te,{label:"Save Sale data",onClick:()=>{we()},isLoading:ve})})]})]})]})}export{Nt as default};
