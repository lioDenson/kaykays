import{j as e,r as n,u as ne,H as Ne,a as Se}from"./app-BCRi5MGn.js";import{X as Ce,A as ke}from"./app-layout-C9BnUCIF.js";import{c as te,a as Q,u as ce}from"./createLucideIcon-DXLz-gdM.js";import{C as Pe,a as le,T as _e}from"./custom-icon-button-4De13Wx7.js";import{C as I}from"./custom-input-DluVew5l.js";import{C as U}from"./custom-selection-Dnr_8Lzp.js";import{C as De}from"./custom-submit-button-qvwcJSdH.js";import{L as qe,I as Ie}from"./label-BBkN4fpl.js";import{u as Te,c as Ee,a as Fe,b as Re}from"./index-DiLCHdJx.js";import{u as Me}from"./index-C9mx0iqs.js";import{P as de}from"./index-DD7SgYLd.js";import{C as ie}from"./custom-text-area-B-TPIuY0.js";import{C as $e}from"./custom-toaster-BLeAqqnF.js";import{s as Ae}from"./index-vmwrf4-U.js";import{P as Be}from"./plus-BM7ErWGD.js";import"./app-BANY8sLb.js";import"./loader-BgN5gves.js";import"./input-D1jLMuxh.js";import"./search-DcO6qyze.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],Oe=te("Car",Le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ze=te("CirclePlus",He);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]],Ue=te("Tags",Ke);function oe({className:o,...a}){return e.jsx("div",{"data-slot":"skeleton",className:Q("bg-primary/10 animate-pulse rounded-md",o),...a})}const Qe=({productCount:o,total:a,fee:l=0})=>{const[u,i]=n.useState(!0);return e.jsxs(e.Fragment,{children:[u&&e.jsxs("div",{className:"fixed top-15 right-2 z-50 grid items-center gap-2 rounded-2xl border bg-white px-2 py-2 shadow-lg transition-all duration-600",children:[e.jsxs("div",{className:"flex gap-4 justify-around",children:[e.jsx("button",{onClick:()=>i(!1),className:"absolute -top-2 -right-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white shadow hover:bg-red-300",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-green-500 text-xs font-bold text-white",children:o}),e.jsxs("span",{className:"text-sm font-semibold text-red-700",children:[Math.round(a)," Ksh"]})]}),l>0&&e.jsxs("div",{className:"flex gap-2 justify-around items-center",children:[e.jsxs("span",{className:"rounded-full  p-0.5 text-center text-xs text-black",children:[" ",e.jsx(Oe,{})," "]}),e.jsxs("span",{className:"text-red-700 text-xs font-bolder",children:[l," Ksh"]})]})]}),!u&&e.jsx("button",{onClick:()=>i(!0),className:"fixed right-1 bottom-6 z-50 flex items-center gap-1 rounded bg-green-500/70 py-2 text-white shadow-lg transition hover:bg-green-300",children:e.jsx(Pe,{className:"font-bolder h-6 w-4"})})]})};var W="Switch",[We,bt]=Ee(W),[Xe,Ve]=We(W),ue=n.forwardRef((o,a)=>{const{__scopeSwitch:l,name:u,checked:i,defaultChecked:S,required:C,disabled:w,value:b="on",onCheckedChange:T,form:y,...k}=o,[f,P]=n.useState(null),d=ce(a,h=>P(h)),x=n.useRef(!1),A=f?y||!!f.closest("form"):!0,[E,_]=Te({prop:i,defaultProp:S??!1,onChange:T,caller:W});return e.jsxs(Xe,{scope:l,checked:E,disabled:w,children:[e.jsx(de.button,{type:"button",role:"switch","aria-checked":E,"aria-required":C,"data-state":he(E),"data-disabled":w?"":void 0,disabled:w,value:b,...k,ref:d,onClick:Fe(o.onClick,h=>{_(g=>!g),A&&(x.current=h.isPropagationStopped(),x.current||h.stopPropagation())})}),A&&e.jsx(fe,{control:f,bubbles:!x.current,name:u,value:b,checked:E,required:C,disabled:w,form:y,style:{transform:"translateX(-100%)"}})]})});ue.displayName=W;var me="SwitchThumb",pe=n.forwardRef((o,a)=>{const{__scopeSwitch:l,...u}=o,i=Ve(me,l);return e.jsx(de.span,{"data-state":he(i.checked),"data-disabled":i.disabled?"":void 0,...u,ref:a})});pe.displayName=me;var Ge="SwitchBubbleInput",fe=n.forwardRef(({__scopeSwitch:o,control:a,checked:l,bubbles:u=!0,...i},S)=>{const C=n.useRef(null),w=ce(C,S),b=Me(l),T=Re(a);return n.useEffect(()=>{const y=C.current;if(!y)return;const k=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(k,"checked").set;if(b!==l&&P){const d=new Event("click",{bubbles:u});P.call(y,l),y.dispatchEvent(d)}},[b,l,u]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...i,tabIndex:-1,ref:w,style:{...i.style,...T,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});fe.displayName=Ge;function he(o){return o?"checked":"unchecked"}var xe=ue,Je=pe;const ve=n.forwardRef(({className:o,...a},l)=>e.jsx(xe,{className:Q("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",o),...a,ref:l,children:e.jsx(Je,{className:Q("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));ve.displayName=xe.displayName;const Ye=({checked:o,onChange:a,label:l,hideLabel:u=!1,className:i,error:S})=>e.jsxs("div",{className:"gri",children:[e.jsxs(qe,{className:"grid cursor-pointer gap-2",children:[!u&&e.jsx("span",{className:"",children:l}),e.jsx(ve,{className:Q("",i),checked:o,onCheckedChange:a})]}),e.jsx(Ie,{message:S,className:"mt-2"})]});function M(o){let a=o;a.startsWith(".")&&(a="0"+a),a=a.replace(/[^0-9.]/g,"");const l=a.indexOf(".");l!==-1&&(a=a.slice(0,l+1)+a.slice(l+1).replace(/\./g,"")),a.length>1&&a[0]==="0"&&a[1]!=="."&&(a=a.replace(/^0+/,""),a===""&&(a="0"));const u=a===""||a==="."?0:parseFloat(a)||0;return{raw:a,numeric:u}}function ee(o){const a=o.replace(/\.$/,"")||"0",l=parseFloat(a)||0;return{raw:a,numeric:l}}const $=o=>({index:o,id:null,price:0,subTotal:0,batchNumber:"",name:"",quantity:"",display_name:"",unit:""});function yt({customers:o,products:a,deliveries:l,riders:u}){const{errors:i}=ne().props,{flash:S}=ne().props,[C,w]=n.useState(!0),[b,T]=n.useState(null),[y,k]=n.useState(1),[f,P]=n.useState(!1),[d,x]=n.useState([$(0)]),[A,E]=n.useState(0),_={rider_id:null,delivery_id:null,description:"",status:"pending"},[h,g]=n.useState(_),[be,se]=n.useState(!1);n.useEffect(()=>{const t=d.filter(c=>c.id!=null&&Number(c.quantity)>0);E(t.length);const s=d[d.length-1],r=s.id!=null&&Number(s.quantity)>0;w(!r)},[d]);const ye=(t,s)=>{const r=a.find(p=>p.id===t?.value),c=[...d],m=c[s];if(!r)c[s]=$(m.index),c[s].quantity=m.quantity,c[s].quantityRaw=m.quantityRaw;else{const p=Number(m.quantity)||0;c[s]={...m,id:r.id,name:r.name,price:r.price,display_name:r.display_name,unit:r.unit,subTotal:Number((p*r.price).toFixed(2))||0}}x(c)},ge=t=>{const s=d.filter((r,c)=>c!==t);s.length===0&&(s.push($(y)),k(r=>r+1)),x(s)},we=()=>{const t=d[d.length-1];t.id==null||Number(t.quantity)===0||t.quantity===""||(x(s=>[...s,$(y)]),k(s=>s+1))},j=d.reduce((t,s)=>t+s.subTotal,0).toFixed(0),[N,X]=n.useState(0),[F,V]=n.useState(0),[R,ae]=n.useState(0),[G,J]=n.useState(j),[B,L]=n.useState(null),[Y,O]=n.useState(null),[H,z]=n.useState(null),Z=l&&l.length>0,[v,D]=n.useState({raw:"",numeric:0}),q=n.useMemo(()=>Number(j)+Number(v?.numeric??0),[j,v.numeric]),K=(t,s)=>{let r=F,c=N;t==="mpesa"?(r=s,V(s)):(c=s,X(s)),r+c>q&&(t==="mpesa"?(r=q-c,V(Math.max(0,r))):(c=q-r,X(Math.max(0,c))));const m=r+c;ae(m),J((q-m).toFixed(0))};n.useEffect(()=>{const t=q-R;J(t.toFixed(0))},[q,R]),n.useEffect(()=>{K("cash",N)},[q,K,N]);const re=n.useMemo(()=>({customer:b,total:parseInt(j).toString(),products:d.filter(t=>t.id!=null&&Number(t.quantity)>0),cash:N,mpesa:F,balance:G,totalPaid:R,isDelivery:f,deliveryData:f?h:null,deliveryFee:f?v:null}),[b,j,d,N,F,G,R,f,h,v]),je=()=>{se(!0),Se.post(Ae("sales.store",re),{},{onSuccess:()=>{T(null),x([$(0)]),k(1),X(0),V(0),ae(0),J(j),P(!1),g(_),O(null),z(null),D({raw:"",numeric:0}),L(null)},onFinish:()=>{se(!1)}})};return e.jsxs(ke,{children:[e.jsx(Ne,{title:"Sales"}),e.jsx($e,{flash:S}),e.jsxs("div",{className:"flex w-full flex-col justify-center",children:[e.jsxs("div",{className:"flex w-full items-center justify-between px-4",children:[e.jsx("h1",{className:"text-2xl font-medium",children:"Sales"}),e.jsx(Qe,{fee:Number(re.deliveryFee?.numeric),productCount:A,total:isNaN(Number(j))?0:Number(j)})]}),e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsxs("div",{className:"m-2 flex w-11/12 flex-col justify-center gap-4 rounded border-2 p-4 md:w-10/12",children:[e.jsx("div",{className:"font-bolder",children:"Customer"}),e.jsxs("div",{className:"flex w-full justify-between gap-4",children:[e.jsx(U,{align:"start",data:o.map(t=>({id:t.id,name:t.user.name})),onSelect:t=>T(t),selectedOption:b,label:"Select Customer",className:"w-full",error:i.customer}),e.jsx(Ye,{checked:f,onChange:()=>{P(!f),L(null),g(_),O(null),z(null),D({raw:"",numeric:0})},label:"Set as Delivery?",className:"bg-pink-300",error:i.isDelivery||i.deliveryData})]}),f&&e.jsxs("div",{className:"flex items-center justify-between gap-4 border-0 border-t-2 pt-2 md:justify-around",children:[B==null||B==!1?e.jsxs(oe,{onClick:()=>{L(!0),O(null),z(null),g(_),D({raw:"",numeric:0})},className:"flex h-[100px] w-1/2 cursor-pointer items-center justify-center gap-2 overflow-hidden p-2 hover:border-2 hover:bg-primary/70 hover:shadow-2xs md:w-1/4",children:[e.jsx(ze,{})," ",e.jsx("span",{children:"Create New Delivery"})]}):e.jsxs("div",{className:`flex ${Z?"flex-col gap-2":"w-full items-center justify-around"} ${i.deliveryData||i.deliveryFee?"border border-red-500/80":""} rounded-2xl p-2`,children:[e.jsx(U,{data:u.map(t=>({id:t.id,name:t.user.name})),onSelect:t=>{O(t.value),g({rider_id:t.value,status:"pending",delivery_id:null,description:""})},selectedOption:Y?{value:Y,label:u.find(t=>t.id===Y)?.user.name||""}:null,align:"start",label:"Select Rider",placeholder:"Select a rider to create delivery",error:i.rider_id}),e.jsx(ie,{id:"description",label:"Delivery description",value:h.description||"",onChange:t=>{g({...h,description:t.target.value||""})}}),e.jsx(I,{id:"delivery_fee",name:"deliver_fee",label:"Delivery Fee (KSH)",placeholder:"Enter amount to charge for delivery",type:"text",value:v.raw??(isNaN(Number(v.raw))?"":String(v.numeric)),onChange:t=>{const{raw:s,numeric:r}=M(t.target.value);D({raw:s,numeric:r})},onBlur:t=>{const{raw:s,numeric:r}=ee(t.target.value);D({raw:s,numeric:r})},error:i.deliveryFee})]}),B==null||B==!0?Z&&e.jsxs(oe,{onClick:()=>L(!1),className:"flex h-[100px] w-1/2 cursor-pointer items-center justify-center gap-2 overflow-hidden hover:border-2 hover:bg-primary/70 hover:shadow-2xs md:w-1/4",children:[e.jsx(Ue,{})," ",e.jsx("span",{children:"Attach to Delivery"})]}):e.jsxs("div",{className:`flex ${Z?"flex-col gap-2":"w-full items-center justify-around"} ${i.deliveryData||i.deliveryFee?"border border-red-500/80":""} rounded-2xl p-2`,children:[e.jsx(U,{data:l?.map(t=>({id:t.id,name:`Delivery #${t.id} - ${t.rider.user.name} (${t.status})`}))||[],label:"Select Delivery",placeholder:"Select Delivery to attach sale to",onSelect:t=>{const s=l?.find(r=>r.id===t.value)||{};z(t.value),g({..._,delivery_id:s.id,description:s.description||""})},selectedOption:H?{value:H,label:`Delivery #${H} - ${l?.find(t=>t.id===H)?.rider.user.name} `}:null,align:"start",error:i.delivery_id}),e.jsx(ie,{id:"description",label:"Delivery description",value:h.description||"",onChange:t=>{g({...h,description:t.target.value||""})}}),e.jsx(I,{id:"delivery_fee",name:"deliver_fee",label:"Delivery Fee (KSH)",placeholder:"Enter amount to charge for delivery",type:"text",value:v.raw??(isNaN(Number(v.raw))?"":String(v.numeric)),onChange:t=>{const{raw:s,numeric:r}=M(t.target.value);D({raw:s,numeric:r})},onBlur:t=>{const{raw:s,numeric:r}=ee(t.target.value);D({raw:s,numeric:r})},error:i.deliveryFee})]})]})]}),e.jsxs("div",{className:"m-2 flex w-11/12 flex-col justify-center gap-4 rounded border-2 p-4 md:w-10/12",children:[e.jsx("div",{className:"text-bol",children:"Sales Products"}),d.map((t,s)=>e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("span",{className:"relative left-4 z-10 flex h-6 w-8 items-center justify-center rounded bg-primary p-1 text-xs text-secondary",children:s+1}),e.jsxs("div",{className:"md grid min-w-10/12 grid-cols-2 gap-6 rounded-2xl border p-4 md:flex md:justify-around",children:[e.jsx(U,{data:a,label:"Product",placeholder:"Select Product",onSelect:r=>{ye(r,s)},selectedOption:d[s].id?{value:d[s].id,label:d[s].display_name}:null,error:i[`products.${s}.id`]||i.products}),e.jsx(I,{className:"flex-1",id:`quantity-${s}`,name:"quantity",label:"Quantity",type:"text",step:.1,value:t.quantityRaw??(t.quantity===""?"":String(t.quantity)),disabled:t.id==null,onChange:r=>{const{raw:c,numeric:m}=M(r.target.value),p=[...d];p[s]={...p[s],quantityRaw:c,quantity:m,subTotal:m*(p[s].price??0)},x(p)},onBlur:r=>{const{raw:c,numeric:m}=ee(r.target.value),p=[...d];p[s]={...p[s],quantityRaw:c,quantity:m,subTotal:m*(p[s].price??0)},x(p)},error:i[`products.${s}.quantity`]}),t.price!=0?e.jsxs("div",{className:"mt-4 flex flex-3 items-center justify-center gap-3 font-bold",children:[e.jsx("span",{children:"@"})," ",e.jsxs("span",{children:[t.price," "]})," ",e.jsxs("span",{children:[t.name&&"/"," ",t.unit," "]})]}):e.jsx("div",{}),e.jsxs("div",{className:"mt-5 flex flex-2 items-center justify-end gap-2 p-2 px-6 font-bold text-green-400 md:border-b-2",children:[e.jsx("span",{children:t.subTotal.toFixed(0)})," ",e.jsx("span",{children:"ksh"})]})]}),e.jsx(le,{icon:_e,onClick:()=>ge(s),className:"relative right-2 flex h-8 w-8 items-center justify-center rounded bg-red-50 p-1 text-xs text-red-900 hover:bg-red-200"})]},t.index)),e.jsx("div",{className:"flex justify-end px-4",children:e.jsx(le,{icon:Be,label:"Add Product",showLabel:!0,onClick:we,disabled:C,className:"w-[150px] bg-primary/90 p-2 hover:bg-primary/30"})})]}),e.jsxs("div",{className:"m-2 mx-5 flex w-11/12 flex-col justify-center gap-4 rounded border-2 p-4 md:w-10/12",children:[e.jsx("div",{className:"font-bolder",children:"Payment Details"}),e.jsxs("div",{className:"grid grid-cols-2 items-center justify-center gap-4 md:flex",children:[e.jsx(I,{id:"mpesa",name:"mpesa",label:"Mpesa Amount",type:"text",placeholder:"Enter Amount paid ",value:!isNaN(F)&&F!==0?F:"",onChange:t=>{const{numeric:s}=M(t.target.value);K("mpesa",s)}}),e.jsx(I,{id:"cash",name:"cash",label:"Cash Amount",type:"text",placeholder:"Enter Amount paid ",value:!isNaN(N)&&N!==0?N:"",onChange:t=>{const{numeric:s}=M(t.target.value);K("cash",s)}}),e.jsx(I,{id:"total",name:"total",readOnly:!0,label:"Total Paid",className:"w-3/5 bg-white text-center font-bold text-green-500 md:w-1/2",value:`${R} ksh`,error:i.totalPaid}),e.jsx(I,{id:"balance",name:"balance",label:"Balance",readOnly:!0,className:"w-3/5 bg-white text-end font-bold text-red-500 md:w-1/2",value:`${G} ksh`})]})]}),e.jsx("div",{className:"m-2 flex w-11/12 flex-col justify-center gap-4 rounded border-2 p-4 md:w-10/12",children:e.jsx(De,{label:"Save Sale data",onClick:()=>{je()},isLoading:be})})]})]})]})}export{yt as default};
