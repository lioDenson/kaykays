import{r as i,j as e,b as D,u as w,H as T,a as S}from"./app.js";import{D as E,c as M,d as L,e as A,f as B,g as k,A as I}from"./app-layout.js";import{L as R,I as F}from"./label.js";import{C as p}from"./custom-input.js";import{C as H,S as Q,T as U,a as O,b as y,c,d as P,e as $}from"./custom-searchbar.js";import{C as W}from"./custom-submit-button.js";import{C as q}from"./custom-text-area.js";import{A as z}from"./auth-layout.js";import{s as v}from"./index3.js";import"./app2.js";import"./createLucideIcon.js";import"./index2.js";import"./index.js";import"./input.js";import"./search.js";import"./loader-circle.js";import"./loader.js";const G=({trigger:t,label:m,items:r,error:l,onChange:o})=>{const[u,x]=i.useState(""),j=n=>{x(n),o(n)};return e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:m}),e.jsxs(E,{children:[e.jsx(M,{asChild:!0,children:e.jsx("div",{className:"border rounded flex items-center px-4",children:u?r.find(n=>n.value===u)?.label:t})}),e.jsxs(L,{className:"w-56",children:[e.jsx(A,{children:m}),e.jsx(B,{}),r.map(n=>e.jsx(k,{onClick:()=>j(n.value),className:"cursor-pointer",children:n.label},n.value))]})]}),l&&e.jsx(F,{message:l,className:"mt-1"})]})};function J({query:t,routeName:m,isEditing:r,isSearching:l,filter:o}){const[u,x]=i.useState(t),[j,n]=i.useState(!1),[h,g]=i.useState([]);return i.useEffect(()=>{const a=setTimeout(()=>{x(t)},500);return()=>clearTimeout(a)},[t]),i.useEffect(()=>{u&&!r&&(n(!0),l?.(!0),D.get(m,{params:{query:u}}).then(a=>{g(a.data)}).finally(()=>{n(!1),l?.(!1)}))},[u,r,m,l]),{results:i.useMemo(()=>o?h.filter(a=>o.includes(a.id)):h,[h,o]),searching:j}}function me({customer:t,customersIds:m}){const r=t!=null,l=w().props.errors,[o,u]=i.useState(""),[x,j]=i.useState(!1),[n,h]=i.useState(!1),[g,f]=i.useState(!1),[a,d]=i.useState({name:t?.user?.name||"",email:t?.user?.email||"",phone:t?.user?.phone||"",bill_cycle:t?.bill_cycle||"",street:t?.street||"",estate:t?.estate||"",house_number:t?.house_number||"",description:t?.description||"",user_id:t?.user_id||0,is_edit:r}),b=J({query:o,routeName:v("users.search"),isSearching:j,filter:m});i.useEffect(()=>{if(!r){if(o===""){d({name:"",email:"",phone:"",bill_cycle:"",street:"",estate:"",house_number:"",description:"",user_id:0,is_edit:r});return}if(b.results.length>0){const s=b.results[0];d(C=>({...C,name:s.name,email:s.email,phone:s.phone,user_id:s.id}))}else d(s=>({...s,name:"",email:"",phone:"",user_id:0}))}},[b.results,o,r]);const _=()=>(h(!0),r?S.put(v("customers.update",t.id),a,{onFinish:()=>{h(!1)}}):S.post(v("customers.store"),a,{onFinish:()=>{h(!1)}})),N=s=>{f(!0),u(s.name),d({...a,user_id:s.id,name:s.name,email:s.email,phone:s.phone})};return e.jsxs(I,{children:[e.jsx(T,{title:r?`Updated ${t.user.name}`:"Create Customer"}),e.jsxs(z,{title:r?`Updated ${t.user.name}`:"Create Customer",description:r?`Fill the form to update ${t.user.name} customer`:"Fill the form to create a new customer",children:[!r&&e.jsx(H,{value:o,searching:x,setQuery:s=>{f(!1),u(s)}}),b.results.length>0&&o!==""&&!g&&e.jsxs(Q,{children:[e.jsx("div",{className:"max-h-[25vh]",children:e.jsxs(U,{children:[e.jsx(O,{children:e.jsxs(y,{children:[e.jsx(c,{}),e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Phone"})]})}),e.jsx(P,{className:"text-xs",children:b.results.map((s,C)=>e.jsxs(y,{className:"cursor-pointer",onClick:N.bind(null,s),children:[e.jsx(c,{children:C+1}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.email}),e.jsx(c,{children:s.phone})]},s.id))})]})}),e.jsx($,{orientation:"vertical"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 space-x-2",children:[e.jsx(p,{id:"name",name:"name",label:"Name",disabled:!r,readOnly:!r,error:l.name||l.user_id||l.i,value:a.name,onChange:s=>d({...a,name:s.target.value})}),e.jsx(p,{id:"email",name:"email",label:"Email",disabled:!0,readOnly:!0,error:l.email,value:a.email})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 space-x-2",children:[e.jsx(p,{id:"phone",name:"phone",label:"Phone",disabled:!r,readOnly:!r,error:l.phone,value:a.phone,onChange:s=>d({...a,phone:s.target.value})}),e.jsx(p,{id:"street",name:"street",label:"Street",error:l.street,value:a.street,onChange:s=>d({...a,street:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 space-x-2",children:[e.jsx(p,{id:"estate",name:"estate",label:"Estate",error:l.estate,value:a.estate,onChange:s=>d({...a,estate:s.target.value})}),e.jsx(p,{id:"house_number",name:"house_number",label:"House Number",error:l.house_number,value:a.house_number,onChange:s=>d({...a,house_number:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 space-x-2",children:[e.jsx(q,{id:"description",name:"description",label:"Description",error:l.description,onChange:s=>d({...a,description:s.target.value}),value:a.description.toString()}),e.jsx("div",{className:"grid gap-2",children:e.jsx(G,{label:"Bill Cycle",error:l.bill_cycle,items:[{label:"Daily",value:"daily"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"}],trigger:"Select Bill Cycle",onChange:s=>d({...a,bill_cycle:s})})})]}),e.jsx(W,{onClick:_,isLoading:n,label:r?"Update Customer":"Create Customer"})]})]})}export{me as default};
